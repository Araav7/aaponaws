---
- name: Add user to JBoss EAP
  hosts: 10.1.0.30
  become: yes

  vars:
    jboss_home: "home/ec2-userb/opt/jboss-eap-7.4"
    jboss_username: "admin"
    jboss_password: "password"
    jboss_new_username: "newuser"
    jboss_new_password: "newpassword"

  tasks:
    - name: Add user to JBoss EAP
      shell: "{{ jboss_home }}/bin/add-user.sh {{ jboss_new_username }} {{ jboss_new_password }}"
      args:
        executable: /bin/bash
        creates: "{{ jboss_home }}/standalone/configuration/application-users.properties"
        stdin: |
          {{ jboss_password }}
          {{ jboss_password }}

    - name: Print JBoss EAP users
      shell: "cat {{ jboss_home }}/standalone/configuration/application-users.properties"
